<!-- These targets are used by netbeans ide -->
<project name="rti-common-nb" default="-fail">
    
    <import file="common-build.xml"/>
    
    <target name="-run-selected-file" depends="-init-deps,compile-java-no-deps,-init-java">
        <fail unless="files">Must set property 'files'</fail>
        <condition property="agentargs" value="${rtibuild.dir}/project/dist/rtibuild_1_0.jar" else="">
            <istrue value="${use.reload.agent}"/>
        </condition>
        <pathconvert property="agentargs.converted">
            <path location="${agentargs}"/>
        </pathconvert>
        <condition property="vmarg" value="-javaagent:${agentargs.converted}" else="">
            <istrue value="${use.reload.agent}"/>
        </condition>
        <runjava main="${files}" cp="${run.classpath.computed}">
            <vmargs>
                <!--
                <jvmarg value="-Dcom.sun.management.jmxremote"/>
                -->
                <!-- the -D_foo makes sure that an empty line is not used if ${vmarg} is not set
                as this breaks things on linux with ant 1.6.5 -->
                <jvmarg value="-D__foo ${vmarg}"/>
            </vmargs>
        </runjava>
    </target>
    
    <target name="-compile-selected" depends="-init-javac">
        <fail unless="files">Must set property 'files'</fail>
        <javacompile includes="${files}" src="${src.dir}" dest="${build.dir}" cp="${build.classpath}" fork="false" />
    </target>
    
    <target name="-compile-selected-test" depends="-init-javac">
        <fail unless="files">Must set property 'files'</fail>
        <javacompile includes="${files}" src="test/src" dest="test/bin" cp="${test.classpath}" fork="false" />
    </target>
    
    <target name="-redefine" depends="-init">
        <taskdef name="redefine" classpath="${rtibuild.dir}/project/dist/rtibuild_1_0.jar" classname="rti.build.ant.ReloadTask"/>
        <collectproducts/>
        <redefine projectDeps="${collected.product.deps}"/>
    </target>
    
    <target name="profile" description="Profile Project" depends="-init-deps,compile-java">
        <fail unless="netbeans.home">This target can only run inside the NetBeans IDE.</fail>
        <nbprofiledirect>
            <classpath> 
                <path path="${run.classpath.computed}"/>
            </classpath>
        </nbprofiledirect>
        <java jvm="${profiler.info.jvm}" fork="true" classname="${profile.class}" classpath="${run.classpath.computed}">
            <jvmarg value="${profiler.info.jvmargs.agent}"/>
            <jvmarg line="${profiler.session.jvm.args}"/>
        </java>
    </target>
    
    <target name="-debug-selected-files" depends="-init-deps,-init-java" if="netbeans.home" description="Debug a Single File">
        <fail unless="classname">Must set property 'classname'</fail>
        <pathconvert property="src.paths">
            <chainedmapper>
                <flattenmapper/>
                <globmapper from="*" to="../*/src"/>
            </chainedmapper>
            <path>
                <filelist dir=".." files="${product.deps}"/>
            </path>
        </pathconvert>
        <nbjpdastart name="${classname}" addressproperty="jpda.address" transport="dt_socket">
            <classpath path="${run.classpath.computed}:${debug.classpath}"/>
            <sourcepath path="${src.paths}"/>
        </nbjpdastart>
        <runjava main="${classname}" cp="${run.classpath.computed}">
            <vmargs>
                <jvmarg value="-Xdebug"/>
                <jvmarg value="-Xnoagent"/>
                <jvmarg value="-Djava.compiler=none"/>
                <jvmarg value="-Xrunjdwp:transport=dt_socket,address=${jpda.address}"/>
            </vmargs>
        </runjava>
    </target>
    
    <target name="-debug-test-single" depends="-init-java">
        <ant antfile="${test.dir}/build.xml" target="-debug-test-single"/>
    </target>
    
    <target name="-test-single" depends="-init-java,compile-java-no-deps">
        <ant antfile="${test.dir}/build.xml" target="-test-single"/>
    </target>
    
</project>
